"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4173],{60035:function(e,t,n){var r=n(9109).lW;let o=void 0!==r,a=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,l=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function i(e,t,n){null==n&&null!==t&&"object"==typeof t&&(n=t,t=void 0),o&&r.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let i=JSON.parse(e,t);if(null===i||"object"!=typeof i)return i;let c=n&&n.protoAction||"error",u=n&&n.constructorAction||"error";if("ignore"===c&&"ignore"===u)return i;if("ignore"!==c&&"ignore"!==u){if(!1===a.test(e)&&!1===l.test(e))return i}else if("ignore"!==c&&"ignore"===u){if(!1===a.test(e))return i}else if(!1===l.test(e))return i;return s(i,{protoAction:c,constructorAction:u,safe:n&&n.safe})}function s(e,{protoAction:t="error",constructorAction:n="error",safe:r}={}){let o=[e];for(;o.length;){let e=o;for(let a of(o=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(a,"__proto__")){if(!0===r)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete a.__proto__}if("ignore"!==n&&Object.prototype.hasOwnProperty.call(a,"constructor")&&Object.prototype.hasOwnProperty.call(a.constructor,"prototype")){if(!0===r)return null;if("error"===n)throw SyntaxError("Object contains forbidden prototype property");delete a.constructor}for(let e in a){let t=a[e];t&&"object"==typeof t&&o.push(t)}}}return e}function c(e,t,n){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(e,t,n)}finally{Error.stackTraceLimit=r}}e.exports=c,e.exports.default=c,e.exports.parse=c,e.exports.safeParse=function(e,t){let n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=n}},e.exports.scan=s},34492:function(e,t,n){/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2265),o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=r.useState,l=r.useEffect,i=r.useLayoutEffect,s=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!o(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=a({inst:{value:n,getSnapshot:t}}),o=r[0].inst,u=r[1];return i(function(){o.value=n,o.getSnapshot=t,c(o)&&u({inst:o})},[e,n,t]),l(function(){return c(o)&&u({inst:o}),e(function(){c(o)&&u({inst:o})})},[e]),s(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},10554:function(e,t,n){e.exports=n(34492)},84173:function(e,t,n){let r;n.d(t,{RJ:function(){return eC},GO:function(){return eI}});var o=n(2265);n(60035),n(25566);var a=((e,t=21)=>(n=t)=>{let r="",o=n;for(;o--;)r+=e[Math.random()*e.length|0];return r})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),l={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},i={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},s={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},c={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},u={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},d={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},f={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},p={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>null==e||"object"!=typeof e||!("id"in e)||"string"!=typeof e.id||!("type"in e)||"string"!=typeof e.type||!("function"in e)||null==e.function||"object"!=typeof e.function||!("arguments"in e.function)||"string"!=typeof e.function.name||"string"!=typeof e.function.arguments))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},g={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},y={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},h={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId", "toolName", "args", and "result" property.');return{type:"tool_result",value:e}}},m={[l.code]:l,[i.code]:i,[s.code]:s,[c.code]:c,[u.code]:u,[d.code]:d,[f.code]:f,[p.code]:p,[g.code]:g,[y.code]:y,[h.code]:h};l.name,l.code,i.name,i.code,s.name,s.code,c.name,c.code,u.name,u.code,d.name,d.code,f.name,f.code,p.name,p.code,g.name,g.code,y.name,y.code,h.name,h.code;var _=[l,i,s,c,u,d,f,p,g,y,h].map(e=>e.code),v=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let n=e.slice(0,t);if(!_.includes(n))throw Error(`Failed to parse stream string. Invalid code ${n}.`);let r=JSON.parse(e.slice(t+1));return m[n].parse(r)};async function*b(e,{isAborted:t}={}){let n=new TextDecoder,r=[],o=0;for(;;){let{value:a}=await e.read();if(a&&(r.push(a),o+=a.length,10!==a[a.length-1]))continue;if(0===r.length)break;let l=function(e,t){let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return e.length=0,n}(r,o);for(let e of(o=0,n.decode(l,{stream:!0}).split("\n").filter(e=>""!==e).map(v)))yield e;if(null==t?void 0:t()){e.cancel();break}}}function w(e,t){return e&&t&&t.length?{...e,annotations:[...t]}:e}async function E({reader:e,abortControllerRef:t,update:n,onToolCall:r,onFinish:o,generateId:l=a,getCurrentDate:i=()=>new Date}){let s;let c=i(),u={data:[]};for await(let{type:o,value:a}of b(e,{isAborted:()=>(null==t?void 0:t.current)===null})){if("text"===o&&(u.text?u.text={...u.text,content:(u.text.content||"")+a}:u.text={id:l(),role:"assistant",content:a,createdAt:c}),"tool_call"===o){if(null==u.text&&(u.text={id:l(),role:"assistant",content:"",createdAt:c}),null==u.text.toolInvocations&&(u.text.toolInvocations=[]),u.text.toolInvocations.push(a),r){let e=await r({toolCall:a});null!=e&&(u.text.toolInvocations[u.text.toolInvocations.length-1]={...a,result:e})}}else if("tool_result"===o){null==u.text&&(u.text={id:l(),role:"assistant",content:"",createdAt:c}),null==u.text.toolInvocations&&(u.text.toolInvocations=[]);let e=u.text.toolInvocations.findIndex(e=>e.toolCallId===a.toolCallId);-1!==e?u.text.toolInvocations[e]=a:u.text.toolInvocations.push(a)}let e=null;"function_call"===o&&(u.function_call={id:l(),role:"assistant",content:"",function_call:a.function_call,name:a.function_call.name,createdAt:c},e=u.function_call);let t=null;"tool_calls"===o&&(u.tool_calls={id:l(),role:"assistant",content:"",tool_calls:a.tool_calls,createdAt:c},t=u.tool_calls),"data"===o&&u.data.push(...a);let i=u.text;"message_annotations"===o&&(s?s.push(...a):s=[...a],e=w(u.function_call,s),t=w(u.tool_calls,s),i=w(u.text,s)),(null==s?void 0:s.length)&&["text","function_call","tool_calls"].forEach(e=>{u[e]&&(u[e].annotations=[...s])}),n([e,t,i].filter(Boolean).map(e=>({...w(e,s)})),[...u.data])}return null==o||o(u),{messages:[u.text,u.function_call,u.tool_calls].filter(Boolean),data:u.data}}async function x({api:e,messages:t,body:n,streamMode:r="stream-data",credentials:o,headers:a,abortController:l,restoreMessagesOnFailure:i,onResponse:s,onUpdate:c,onFinish:u,onToolCall:d,generateId:f}){var p;let g=await fetch(e,{method:"POST",body:JSON.stringify({messages:t,...n}),headers:{"Content-Type":"application/json",...a},signal:null==(p=null==l?void 0:l())?void 0:p.signal,credentials:o}).catch(e=>{throw i(),e});if(s)try{await s(g)}catch(e){throw e}if(!g.ok)throw i(),Error(await g.text()||"Failed to fetch the chat response.");if(!g.body)throw Error("The response body is empty.");let y=g.body.getReader();switch(r){case"text":{let e=C(),t={id:f(),createdAt:new Date,role:"assistant",content:""};for(;;){let{done:n,value:r}=await y.read();if(n)break;if(t.content+=e(r),t.id=f(),c([{...t}],[]),(null==l?void 0:l())===null){y.cancel();break}}return null==u||u(t),{messages:[t],data:[]}}case"stream-data":return await E({reader:y,abortControllerRef:null!=l?{current:l()}:void 0,update:c,onToolCall:d,onFinish(e){u&&null!=e.text&&u(e.text)},generateId:f});default:throw Error(`Unknown stream mode: ${r}`)}}async function k({api:e,prompt:t,credentials:n,headers:r,body:o,streamMode:a="stream-data",setCompletion:l,setLoading:i,setError:s,setAbortController:c,onResponse:u,onFinish:d,onError:f,onData:p}){try{i(!0),s(void 0);let f=new AbortController;c(f),l("");let g=await fetch(e,{method:"POST",body:JSON.stringify({prompt:t,...o}),credentials:n,headers:{"Content-Type":"application/json",...r},signal:f.signal}).catch(e=>{throw e});if(u)try{await u(g)}catch(e){throw e}if(!g.ok)throw Error(await g.text()||"Failed to fetch the chat response.");if(!g.body)throw Error("The response body is empty.");let y="",h=g.body.getReader();switch(a){case"text":{let e=C();for(;;){let{done:t,value:n}=await h.read();if(t)break;if(y+=e(n),l(y),null===f){h.cancel();break}}break}case"stream-data":for await(let{type:e,value:t}of b(h,{isAborted:()=>null===f}))switch(e){case"text":y+=t,l(y);break;case"data":null==p||p(t)}break;default:throw Error(`Unknown stream mode: ${a}`)}return d&&d(t,y),c(null),y}catch(e){if("AbortError"===e.name)return c(null),null;e instanceof Error&&f&&f(e),s(e)}finally{i(!1)}}function C(e){let t=new TextDecoder;return e?function(e){return t.decode(e,{stream:!0}).split("\n").filter(e=>""!==e).map(v).filter(Boolean)}:function(e){return e?t.decode(e,{stream:!0}):""}}async function I({getStreamedResponse:e,experimental_onFunctionCall:t,experimental_onToolCall:n,updateChatRequest:r,getCurrentMessages:o}){for(;;){let a=await e();if("messages"in a){let e=!1;for(let l of a.messages)if(void 0!==l.function_call&&"string"!=typeof l.function_call||void 0!==l.tool_calls&&"string"!=typeof l.tool_calls){if(e=!0,t){let n=l.function_call;if("object"!=typeof n){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let a=await t(o(),n);if(void 0===a){e=!1;break}r(a)}if(n){let t=l.tool_calls;if(!Array.isArray(t)||t.some(e=>"object"!=typeof e)){console.warn("experimental_onToolCall should not be defined when using tools");continue}let a=await n(o(),t);if(void 0===a){e=!1;break}r(a)}}if(!e)break}else{let e=function(e){for(let t of e.messages){if(void 0!==t.tool_calls)for(let e of t.tool_calls)"object"==typeof e&&e.function.arguments&&"string"!=typeof e.function.arguments&&(e.function.arguments=JSON.stringify(e.function.arguments));void 0!==t.function_call&&"object"==typeof t.function_call&&t.function_call.arguments&&"string"!=typeof t.function_call.arguments&&(t.function_call.arguments=JSON.stringify(t.function_call.arguments))}};if((void 0===a.function_call||"string"==typeof a.function_call)&&(void 0===a.tool_calls||"string"==typeof a.tool_calls))break;if(t){let n=a.function_call;if("object"!=typeof n){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let l=await t(o(),n);if(void 0===l)break;e(l),r(l)}if(n){let t=a.tool_calls;if("object"!=typeof t){console.warn("experimental_onToolCall should not be defined when using functions");continue}let l=await n(o(),t);if(void 0===l)break;e(l),r(l)}}}}var T=n(10554);let O=()=>{},S=O(),R=Object,j=e=>e===S,A=e=>"function"==typeof e,L=(e,t)=>({...e,...t}),N=e=>A(e.then),V=new WeakMap,D=0,F=e=>{let t,n;let r=typeof e,o=e&&e.constructor,a=o==Date;if(R(e)!==e||a||o==RegExp)t=a?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(t=V.get(e))return t;if(t=++D+"~",V.set(e,t),o==Array){for(n=0,t="@";n<e.length;n++)t+=F(e[n])+",";V.set(e,t)}if(o==R){t="#";let r=R.keys(e).sort();for(;!j(n=r.pop());)j(e[n])||(t+=n+":"+F(e[n])+",");V.set(e,t)}}return t},P=new WeakMap,M={},U={},J="undefined",W=typeof window!=J,q=typeof document!=J,B=()=>W&&typeof window.requestAnimationFrame!=J,$=(e,t)=>{let n=P.get(e);return[()=>!j(t)&&e.get(t)||M,r=>{if(!j(t)){let o=e.get(t);t in U||(U[t]=o),n[5](t,L(o,r),o||M)}},n[6],()=>!j(t)&&t in U?U[t]:!j(t)&&e.get(t)||M]},G=!0,[z,H]=W&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[O,O],K={initFocus:e=>(q&&document.addEventListener("visibilitychange",e),z("focus",e),()=>{q&&document.removeEventListener("visibilitychange",e),H("focus",e)}),initReconnect:e=>{let t=()=>{G=!0,e()},n=()=>{G=!1};return z("online",t),z("offline",n),()=>{H("online",t),H("offline",n)}}},Q=!o.useId,X=!W||"Deno"in window,Y=e=>B()?window.requestAnimationFrame(e):setTimeout(e,1),Z=X?o.useEffect:o.useLayoutEffect,ee="undefined"!=typeof navigator&&navigator.connection,et=!X&&ee&&(["slow-2g","2g"].includes(ee.effectiveType)||ee.saveData),en=e=>{if(A(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?F(e):"",t]},er=0,eo=()=>++er;var ea={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function el(...e){let[t,n,r,o]=e,a=L({populateCache:!0,throwOnError:!0},"boolean"==typeof o?{revalidate:o}:o||{}),l=a.populateCache,i=a.rollbackOnError,s=a.optimisticData,c=!1!==a.revalidate,u=e=>"function"==typeof i?i(e):!1!==i,d=a.throwOnError;if(A(n)){let e=[];for(let r of t.keys())!/^\$(inf|sub)\$/.test(r)&&n(t.get(r)._k)&&e.push(r);return Promise.all(e.map(f))}return f(n);async function f(n){let o;let[a]=en(n);if(!a)return;let[i,f]=$(t,a),[p,g,y,h]=P.get(t),m=p[a],_=()=>c&&(delete y[a],delete h[a],m&&m[0])?m[0](2).then(()=>i().data):i().data;if(e.length<3)return _();let v=r,b=eo();g[a]=[b,0];let w=!j(s),E=i(),x=E.data,k=E._c,C=j(k)?x:k;if(w&&f({data:s=A(s)?s(C,x):s,_c:C}),A(v))try{v=v(C)}catch(e){o=e}if(v&&N(v)){if(v=await v.catch(e=>{o=e}),b!==g[a][0]){if(o)throw o;return v}o&&w&&u(o)&&(l=!0,f({data:v=C,_c:S}))}l&&!o&&(A(l)&&(v=l(v,C)),f({data:v,error:S,_c:S})),g[a][1]=eo();let I=await _();if(f({_c:S}),o){if(d)throw o;return}return l?I:v}}let ei=(e,t)=>{for(let n in e)e[n][0]&&e[n][0](t)},es=(e,t)=>{if(!P.has(e)){let n=L(K,t),r={},o=el.bind(S,e),a=O,l={},i=(e,t)=>{let n=l[e]||[];return l[e]=n,n.push(t),()=>n.splice(n.indexOf(t),1)},s=(t,n,r)=>{e.set(t,n);let o=l[t];if(o)for(let e of o)e(n,r)},c=()=>{if(!P.has(e)&&(P.set(e,[r,{},{},{},o,s,i]),!X)){let t=n.initFocus(setTimeout.bind(S,ei.bind(S,r,0))),o=n.initReconnect(setTimeout.bind(S,ei.bind(S,r,1)));a=()=>{t&&t(),o&&o(),P.delete(e)}}};return c(),[e,o,c,a]}return[e,P.get(e)[4]]},[ec,eu]=es(new Map),ed=L({onLoadingSlow:O,onSuccess:O,onError:O,onErrorRetry:(e,t,n,r,o)=>{let a=n.errorRetryCount,l=o.retryCount,i=~~((Math.random()+.5)*(1<<(l<8?l:8)))*n.errorRetryInterval;(j(a)||!(l>a))&&setTimeout(r,i,o)},onDiscarded:O,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:et?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:et?5e3:3e3,compare:(e,t)=>F(e)==F(t),isPaused:()=>!1,cache:ec,mutate:eu,fallback:{}},{isOnline:()=>G,isVisible:()=>{let e=q&&document.visibilityState;return j(e)||"hidden"!==e}}),ef=(e,t)=>{let n=L(e,t);if(t){let{use:r,fallback:o}=e,{use:a,fallback:l}=t;r&&a&&(n.use=r.concat(a)),o&&l&&(n.fallback=L(o,l))}return n},ep=(0,o.createContext)({}),eg=W&&window.__SWR_DEVTOOLS_USE__,ey=eg?window.__SWR_DEVTOOLS_USE__:[],eh=e=>A(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],em=()=>L(ed,(0,o.useContext)(ep)),e_=ey.concat(e=>(t,n,r)=>{let o=n&&((...e)=>{let[r]=en(t),[,,,o]=P.get(ec),a=o[r];return j(a)?n(...e):(delete o[r],a)});return e(t,o,r)}),ev=(e,t,n)=>{let r=t[e]||(t[e]=[]);return r.push(n),()=>{let e=r.indexOf(n);e>=0&&(r[e]=r[r.length-1],r.pop())}};eg&&(window.__SWR_DEVTOOLS_REACT__=o);let eb=o.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}),ew={dedupe:!0};R.defineProperty(e=>{let{value:t}=e,n=(0,o.useContext)(ep),r=A(t),a=(0,o.useMemo)(()=>r?t(n):t,[r,n,t]),l=(0,o.useMemo)(()=>r?a:ef(n,a),[r,n,a]),i=a&&a.provider,s=(0,o.useRef)(S);i&&!s.current&&(s.current=es(i(l.cache||ec),a));let c=s.current;return c&&(l.cache=c[0],l.mutate=c[1]),Z(()=>{if(c)return c[2]&&c[2](),c[3]},[]),(0,o.createElement)(ep.Provider,L(e,{value:l}))},"defaultValue",{value:ed});let eE=(r=(e,t,n)=>{let{cache:r,compare:a,suspense:l,fallbackData:i,revalidateOnMount:s,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:d,refreshWhenOffline:f,keepPreviousData:p}=n,[g,y,h,m]=P.get(r),[_,v]=en(e),b=(0,o.useRef)(!1),w=(0,o.useRef)(!1),E=(0,o.useRef)(_),x=(0,o.useRef)(t),k=(0,o.useRef)(n),C=()=>k.current,I=()=>C().isVisible()&&C().isOnline(),[O,R,N,V]=$(r,_),D=(0,o.useRef)({}).current,F=j(i)?n.fallback[_]:i,M=(e,t)=>{for(let n in D)if("data"===n){if(!a(e[n],t[n])&&(!j(e[n])||!a(K,t[n])))return!1}else if(t[n]!==e[n])return!1;return!0},U=(0,o.useMemo)(()=>{let e=!!_&&!!t&&(j(s)?!C().isPaused()&&!l&&(!!j(c)||c):s),n=t=>{let n=L(t);return(delete n._k,e)?{isValidating:!0,isLoading:!0,...n}:n},r=O(),o=V(),a=n(r),i=r===o?a:n(o),u=a;return[()=>{let e=n(O());return M(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>i]},[r,_]),J=(0,T.useSyncExternalStore)((0,o.useCallback)(e=>N(_,(t,n)=>{M(n,t)||e()}),[r,_]),U[0],U[1]),W=!b.current,q=g[_]&&g[_].length>0,B=J.data,G=j(B)?F:B,z=J.error,H=(0,o.useRef)(G),K=p?j(B)?H.current:B:G,ee=(!q||!!j(z))&&(W&&!j(s)?s:!C().isPaused()&&(l?!j(G)&&c:j(G)||c)),et=!!(_&&t&&W&&ee),er=j(J.isValidating)?et:J.isValidating,ei=j(J.isLoading)?et:J.isLoading,es=(0,o.useCallback)(async e=>{let t,r;let o=x.current;if(!_||!o||w.current||C().isPaused())return!1;let l=!0,i=e||{},s=!h[_]||!i.dedupe,c=()=>Q?!w.current&&_===E.current&&b.current:_===E.current,u={isValidating:!1,isLoading:!1},d=()=>{R(u)},f=()=>{let e=h[_];e&&e[1]===r&&delete h[_]},p={isValidating:!0};j(O().data)&&(p.isLoading=!0);try{if(s&&(R(p),n.loadingTimeout&&j(O().data)&&setTimeout(()=>{l&&c()&&C().onLoadingSlow(_,n)},n.loadingTimeout),h[_]=[o(v),eo()]),[t,r]=h[_],t=await t,s&&setTimeout(f,n.dedupingInterval),!h[_]||h[_][1]!==r)return s&&c()&&C().onDiscarded(_),!1;u.error=S;let e=y[_];if(!j(e)&&(r<=e[0]||r<=e[1]||0===e[1]))return d(),s&&c()&&C().onDiscarded(_),!1;let i=O().data;u.data=a(i,t)?i:t,s&&c()&&C().onSuccess(t,_,n)}catch(n){f();let e=C(),{shouldRetryOnError:t}=e;!e.isPaused()&&(u.error=n,s&&c()&&(e.onError(n,_,e),(!0===t||A(t)&&t(n))&&I()&&e.onErrorRetry(n,_,e,e=>{let t=g[_];t&&t[0]&&t[0](ea.ERROR_REVALIDATE_EVENT,e)},{retryCount:(i.retryCount||0)+1,dedupe:!0})))}return l=!1,d(),!0},[_,r]),ec=(0,o.useCallback)((...e)=>el(r,E.current,...e),[]);if(Z(()=>{x.current=t,k.current=n,j(B)||(H.current=B)}),Z(()=>{if(!_)return;let e=es.bind(S,ew),t=0,n=ev(_,g,(n,r={})=>{if(n==ea.FOCUS_EVENT){let n=Date.now();C().revalidateOnFocus&&n>t&&I()&&(t=n+C().focusThrottleInterval,e())}else if(n==ea.RECONNECT_EVENT)C().revalidateOnReconnect&&I()&&e();else if(n==ea.MUTATE_EVENT)return es();else if(n==ea.ERROR_REVALIDATE_EVENT)return es(r)});return w.current=!1,E.current=_,b.current=!0,R({_k:v}),ee&&(j(G)||X?e():Y(e)),()=>{w.current=!0,n()}},[_]),Z(()=>{let e;function t(){let t=A(u)?u(O().data):u;t&&-1!==e&&(e=setTimeout(n,t))}function n(){!O().error&&(d||C().isVisible())&&(f||C().isOnline())?es(ew).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[u,d,f,_]),(0,o.useDebugValue)(K),l&&j(G)&&_){if(!Q&&X)throw Error("Fallback data is required when using suspense in SSR.");x.current=t,k.current=n,w.current=!1;let e=m[_];if(j(e)||eb(ec(e)),j(z)){let e=es(ew);j(K)||(e.status="fulfilled",e.value=!0),eb(e)}else throw z}return{mutate:ec,get data(){return D.data=!0,K},get error(){return D.error=!0,z},get isValidating(){return D.isValidating=!0,er},get isLoading(){return D.isLoading=!0,ei}}},function(...e){let t=em(),[n,o,a]=eh(e),l=ef(t,a),i=r,{use:s}=l,c=(s||[]).concat(e_);for(let e=c.length;e--;)i=c[e](i);return i(n,o||l.fetcher||null,l)});var ex=async(e,t,n,r,o,a,l,i,s,c,u,d,f,p)=>{var g,y;let h=l.current;n(t.messages,!1);let m=p?t.messages:t.messages.map(({role:e,content:t,name:n,data:r,annotations:o,toolInvocations:a,function_call:l,tool_calls:i,tool_call_id:s})=>({role:e,content:t,...void 0!==n&&{name:n},...void 0!==r&&{data:r},...void 0!==o&&{annotations:o},...void 0!==a&&{toolInvocations:a},tool_call_id:s,...void 0!==l&&{function_call:l},...void 0!==i&&{tool_calls:i}}));return await x({api:e,messages:m,body:{data:t.data,...a.current.body,...null==(g=t.options)?void 0:g.body,...void 0!==t.functions&&{functions:t.functions},...void 0!==t.function_call&&{function_call:t.function_call},...void 0!==t.tools&&{tools:t.tools},...void 0!==t.tool_choice&&{tool_choice:t.tool_choice}},streamMode:c,credentials:a.current.credentials,headers:{...a.current.headers,...null==(y=t.options)?void 0:y.headers},abortController:()=>i.current,restoreMessagesOnFailure(){n(h,!1)},onResponse:d,onUpdate(e,a){n([...t.messages,...e],!1),r([...o||[],...a||[]],!1)},onToolCall:f,onFinish:u,generateId:s})};function ek(e){return"assistant"===e.role&&e.toolInvocations&&e.toolInvocations.length>0&&e.toolInvocations.every(e=>"result"in e)}var eC=function({api:e="/api/chat",id:t,initialMessages:n,initialInput:r="",sendExtraMessageFields:l,experimental_onFunctionCall:i,experimental_onToolCall:s,onToolCall:c,experimental_maxAutomaticRoundtrips:u=0,maxAutomaticRoundtrips:d=u,maxToolRoundtrips:f=d,streamMode:p,onResponse:g,onFinish:y,onError:h,credentials:m,headers:_,body:v,generateId:b=a}={}){let w=(0,o.useId)(),E=null!=t?t:w,x="string"==typeof e?[e,E]:E,[k]=(0,o.useState)([]),{data:C,mutate:T}=eE([x,"messages"],null,{fallbackData:null!=n?n:k}),{data:O=!1,mutate:S}=eE([x,"loading"],null),{data:R,mutate:j}=eE([x,"streamData"],null),{data:A,mutate:L}=eE([x,"error"],null),N=(0,o.useRef)(C||[]);(0,o.useEffect)(()=>{N.current=C||[]},[C]);let V=(0,o.useRef)(null),D=(0,o.useRef)({credentials:m,headers:_,body:v});(0,o.useEffect)(()=>{D.current={credentials:m,headers:_,body:v}},[m,_,v]);let F=(0,o.useCallback)(async t=>{let n=N.current.length;try{S(!0),L(void 0);let n=new AbortController;V.current=n,await I({getStreamedResponse:()=>ex(e,t,T,j,R,D,N,V,b,p,y,g,c,l),experimental_onFunctionCall:i,experimental_onToolCall:s,updateChatRequest:e=>{t=e},getCurrentMessages:()=>N.current}),V.current=null}catch(e){if("AbortError"===e.name)return V.current=null,null;h&&e instanceof Error&&h(e),L(e)}finally{S(!1)}let r=N.current,o=r[r.length-1];r.length>n&&null!=o&&f>0&&ek(o)&&function(e){let t=0;for(let n=e.length-1;n>=0;n--)if("assistant"===e[n].role)t++;else break;return t}(r)<=f&&await F({messages:r})},[T,S,e,D,g,y,h,L,j,R,p,l,i,s,c,f,N,V,b]),P=(0,o.useCallback)(async(e,{options:t,functions:n,function_call:r,tools:o,tool_choice:a,data:l}={})=>(e.id||(e.id=b()),F({messages:N.current.concat(e),options:t,data:l,...void 0!==n&&{functions:n},...void 0!==r&&{function_call:r},...void 0!==o&&{tools:o},...void 0!==a&&{tool_choice:a}})),[F,b]),M=(0,o.useCallback)(async({options:e,functions:t,function_call:n,tools:r,tool_choice:o}={})=>0===N.current.length?null:"assistant"===N.current[N.current.length-1].role?F({messages:N.current.slice(0,-1),options:e,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n},...void 0!==r&&{tools:r},...void 0!==o&&{tool_choice:o}}):F({messages:N.current,options:e,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n},...void 0!==r&&{tools:r},...void 0!==o&&{tool_choice:o}}),[F]),U=(0,o.useCallback)(()=>{V.current&&(V.current.abort(),V.current=null)},[]),J=(0,o.useCallback)(e=>{T(e,!1),N.current=e},[T]),[W,q]=(0,o.useState)(r),B=(0,o.useCallback)((e,t={},n)=>{n&&(D.current={...D.current,...n}),e.preventDefault(),W&&(P({content:W,role:"user",createdAt:new Date},t),q(""))},[W,P]),$=({toolCallId:e,result:t})=>{let n=N.current.map((n,r,o)=>r===o.length-1&&"assistant"===n.role&&n.toolInvocations?{...n,toolInvocations:n.toolInvocations.map(n=>n.toolCallId===e?{...n,result:t}:n)}:n);T(n,!1),ek(n[n.length-1])&&F({messages:n})};return{messages:C||[],error:A,append:P,reload:M,stop:U,setMessages:J,input:W,setInput:q,handleInputChange:e=>{q(e.target.value)},handleSubmit:B,isLoading:O,data:R,addToolResult:$,experimental_addToolResult:$}},eI=function({api:e="/api/completion",id:t,initialCompletion:n="",initialInput:r="",credentials:a,headers:l,body:i,streamMode:s,onResponse:c,onFinish:u,onError:d}={}){let f=(0,o.useId)(),p=t||f,{data:g,mutate:y}=eE([e,p],null,{fallbackData:n}),{data:h=!1,mutate:m}=eE([p,"loading"],null),{data:_,mutate:v}=eE([p,"streamData"],null),[b,w]=(0,o.useState)(void 0),[E,x]=(0,o.useState)(null),C=(0,o.useRef)({credentials:a,headers:l,body:i});(0,o.useEffect)(()=>{C.current={credentials:a,headers:l,body:i}},[a,l,i]);let I=(0,o.useCallback)(async(t,n)=>k({api:e,prompt:t,credentials:C.current.credentials,headers:{...C.current.headers,...null==n?void 0:n.headers},body:{...C.current.body,...null==n?void 0:n.body},streamMode:s,setCompletion:e=>y(e,!1),setLoading:m,setError:w,setAbortController:x,onResponse:c,onFinish:u,onError:d,onData:e=>{v([..._||[],...e||[]],!1)}}),[y,m,e,C,x,c,u,d,w,_,s,v]),T=(0,o.useCallback)(()=>{E&&(E.abort(),x(null))},[E]),O=(0,o.useCallback)(e=>{y(e,!1)},[y]),S=(0,o.useCallback)(async(e,t)=>I(e,t),[I]),[R,j]=(0,o.useState)(r),A=(0,o.useCallback)(e=>{if(e.preventDefault(),R)return S(R)},[R,S]);return{completion:g,complete:S,error:b,setCompletion:O,stop:T,input:R,setInput:j,handleInputChange:e=>{j(e.target.value)},handleSubmit:A,isLoading:h,data:_}}}}]);