(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3381],{69349:function(){},49080:function(){},57588:function(){},3071:function(){},15232:function(){},32120:function(e,t,s){Promise.resolve().then(s.bind(s,45549))},45549:function(e,t,s){"use strict";s.r(t);var r=s(57437),a=s(2265),n=s(4511),i=s(52728),o=s(54008),l=s(41942),c=s(24957),d=s(71849),u=s(92508),h=s(18502),x=s(97199),g=s(93603);s(7395);var m=s(98726),f=s(68330),p=s(74574);s(95152),s(381);var j=s(30998),b=s(38746),y=s(17941),w=s(8570),P=s(74340),S=s(20610),v=s(25443),k=s(43378),C=s(14937),D=s(99240),F=s(89386),E=s(40191),T=s(16829),z=s(61493),N=s(25045),O=s(59226),R=s(99087),U=s(65874),I=s(66248),Y=s(14409),Z=s(24402),W=s(10878),L=s(79494),M=s(44379);m.default.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(m.default.version,"/pdf.worker.js");let A=(0,n.E)(P.xu),_=e=>{let{className:t,children:s}=e,a=/language-(\w+)/.exec(t||"");return a?(0,r.jsx)(d.Z,{style:u.Z,language:a[1],PreTag:"div",children:String(s).replace(/\n$/,"")}):(0,r.jsx)("code",{className:t,children:s})};t.default=()=>{let[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)(""),[u,H]=(0,a.useState)(!1),[J,G]=(0,a.useState)(null),[$,q]=(0,a.useState)(""),[B,K]=(0,a.useState)(""),[V,X]=(0,a.useState)(null),{data:Q}=(0,j.useSession)(),[ee,et]=(0,a.useState)(null),[es,er]=(0,a.useState)(1),[ea,en]=(0,a.useState)(0),[ei,eo]=(0,a.useState)(null),[el,ec]=(0,a.useState)(""),[ed,eu]=(0,a.useState)([]),eh=(0,S.p)(),{isOpen:ex,onOpen:eg,onClose:em}=(0,v.q)(),ef=(0,k.ff)("gray.50","gray.900"),ep=(0,k.ff)("white","gray.800"),ej=(0,k.ff)("gray.200","gray.700"),eb=(0,a.useRef)(null);(0,a.useEffect)(()=>{ey()},[Q]),(0,a.useEffect)(()=>{ew()},[e]);let ey=async()=>{var e;if(null==Q?void 0:null===(e=Q.user)||void 0===e?void 0:e.email)try{let e=await fetch("/api/get-user"),t=await e.json();eo(t.messagesPerMonth)}catch(e){console.error("Error fetching messages remaining:",e)}},ew=()=>{var e;null===(e=eb.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},eP=(0,a.useCallback)(async e=>{try{let t=await fetch("/api/decrement-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e})});if(!t.ok)throw Error("Failed to decrement messages");let s=await t.json();eo(s.messagesRemaining),s.messagesRemaining<=5&&eh({title:"Message limit approaching",description:"You have ".concat(s.messagesRemaining," messages left. Consider upgrading your plan."),status:"warning",duration:5e3,isClosable:!0})}catch(e){console.error("Error decrementing messages:",e),eh({title:"Error",description:"Failed to update message count. Please try again.",status:"error",duration:3e3,isClosable:!0})}},[eh]),eS=async()=>{if(!s.trim())return;if(ei<=0){eg();return}let r={content:s,role:"user"};t(e=>[...e,r]),d(""),H(!0);try{let s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"PDF context: ".concat($.slice(0,1e3))},...e,r]})});if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));let a=s.body.getReader(),n="";for(;;){let{done:e,value:t}=await a.read();if(e)break;n+=new TextDecoder().decode(t)}t(e=>[...e,{role:"assistant",content:n}]),await eP(1)}catch(e){console.error("Error in AI response:",e),G("Failed to get AI response. Please try again.")}finally{H(!1)}},ev=(0,a.useCallback)(e=>{eF(e[0])},[]),{getRootProps:ek,getInputProps:eC,isDragActive:eD}=(0,b.uI)({onDrop:ev,accept:{"application/pdf":[".pdf"]},multiple:!1}),eF=async e=>{if(e)try{en(0);let s=await eE(e);q(s),X(e),K(e.name);let r=await eT(s);t([{role:"assistant",content:'PDF "'.concat(e.name,'" uploaded. Summary:\n\n').concat(r)}]),eh({title:"PDF Processed",description:"Your PDF has been uploaded and summarized.",status:"success",duration:5e3,isClosable:!0})}catch(e){console.error("Error processing PDF:",e),G("Failed to process PDF. Please try again."),eh({title:"Upload Failed",description:"There was an error processing your PDF.",status:"error",duration:3e3,isClosable:!0})}},eE=async e=>{let t=await m.default.getDocument(URL.createObjectURL(e)).promise;et(t.numPages);let s="";for(let e=1;e<=t.numPages;e++){let r=await t.getPage(e);s+=(await r.getTextContent()).items.map(e=>e.str).join(" ")+"\n",en(e/t.numPages*100)}return s},eT=async e=>{try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"You are an AI assistant tasked with summarizing PDF content. Provide a concise summary of the following text:"},{role:"user",content:e.slice(0,2e3)}]})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=t.body.getReader(),r="";for(;;){let{done:e,value:t}=await s.read();if(e)break;r+=new TextDecoder().decode(t)}return r}catch(e){throw console.error("Error getting AI summary:",e),Error("Failed to generate summary. Please try again.")}},ez=e=>{if(!e.trim()){eu([]);return}let t=[];$.split("\n").forEach((s,r)=>{s.toLowerCase().includes(e.toLowerCase())&&t.push({pageNumber:Math.floor(r/20)+1,text:s})}),eu(t),t.length>0&&er(t[0].pageNumber)};return(0,r.jsxs)(D.k,{h:"100vh",children:[(0,r.jsx)(y.Z,{}),(0,r.jsxs)(D.k,{mb:{base:"4rem",md:"0"},flex:1,direction:"column",bg:ef,children:[(0,r.jsxs)(D.k,{p:4,justify:"space-between",align:"center",borderBottomWidth:1,borderColor:ej,children:[(0,r.jsx)(n.E.h1,{className:"text-black font-medium leading-none tracking-tighter text-xl md:text-3xl font-semibold",children:"Chat with PDF"}),(0,r.jsxs)(F.U,{children:[(0,r.jsx)(R.u,{label:"Messages remaining",children:(0,r.jsx)(U.z,{leftIcon:(0,r.jsx)(o.wT4,{}),onClick:eg,variant:"outline",size:"sm",children:ei})}),(0,r.jsxs)(I.J,{children:[(0,r.jsx)(Y.x,{children:(0,r.jsx)(z.h,{icon:(0,r.jsx)(o.O6C,{}),"aria-label":"Search PDF",size:"md"})}),(0,r.jsx)(Z.h,{children:(0,r.jsx)(W.y,{children:(0,r.jsx)(L.b,{children:(0,r.jsxs)(C.g,{children:[(0,r.jsx)(M.I,{placeholder:"Search in PDF",value:el,onChange:e=>ec(e.target.value),onKeyPress:e=>"Enter"===e.key&&ez(el)}),(0,r.jsx)(U.z,{size:"sm",onClick:()=>ez(el),children:"Search"}),(0,r.jsx)(C.g,{align:"stretch",mt:4,maxH:"200px",overflowY:"auto",children:ed.map((e,t)=>(0,r.jsxs)(P.xu,{p:2,bg:ep,borderRadius:"md",cursor:"pointer",onClick:()=>er(e.pageNumber),children:[(0,r.jsxs)(E.x,{fontSize:"sm",children:["Page ",e.pageNumber]}),(0,r.jsx)(O.y$,{query:el,styles:{bg:"yellow.200"},children:e.text})]},t))})]})})})})]})]})]}),(0,r.jsxs)(D.k,{flex:1,overflow:"hidden",children:[(0,r.jsx)(P.xu,{width:"50%",p:4,borderRightWidth:1,borderColor:ej,overflowY:"auto",children:(0,r.jsx)(P.xu,{h:"100%",display:"flex",flexDirection:"column",children:V?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(F.U,{justify:"space-between",mb:4,children:[(0,r.jsx)(E.x,{fontWeight:"bold",noOfLines:1,children:B}),(0,r.jsxs)(F.U,{children:[(0,r.jsx)(z.h,{icon:(0,r.jsx)(l.bUI,{}),onClick:()=>er(e=>Math.max(1,e-1)),disabled:es<=1,"aria-label":"Previous page",size:"sm"}),(0,r.jsxs)(E.x,{fontSize:"sm",children:["Page ",es," of ",ee]}),(0,r.jsx)(z.h,{icon:(0,r.jsx)(l.Dli,{}),onClick:()=>er(e=>Math.min(ee,e+1)),disabled:es>=ee,"aria-label":"Next page",size:"sm"})]})]}),(0,r.jsx)(P.xu,{flex:1,overflowY:"auto",bg:"gray.100",borderRadius:"md",p:4,children:(0,r.jsx)(f.Z,{file:V,onLoadSuccess:e=>{let{numPages:t}=e;return et(t)},children:(0,r.jsx)(p.Z,{pageNumber:es,width:400})})})]}):(0,r.jsxs)(C.g,{spacing:4,align:"center",justify:"center",h:"100%",...ek(),children:[(0,r.jsx)("input",{...eC()}),(0,r.jsx)(E.x,{fontSize:"lg",fontWeight:"bold",children:"Upload a PDF to Start"}),(0,r.jsxs)(P.xu,{borderWidth:2,borderStyle:"dashed",borderRadius:"md",p:10,textAlign:"center",bg:eD?"blue.50":"transparent",borderColor:eD?"blue.300":"gray.300",transition:"all 0.2s",children:[(0,r.jsx)(o.h5O,{className:"mx-auto text-center",size:40,color:(0,k.ff)("gray.500","gray.400")}),(0,r.jsx)(E.x,{mt:2,children:eD?"Drop the PDF here":"Drag & drop a PDF here, or click to select"})]}),ea>0&&ea<100&&(0,r.jsxs)(P.xu,{w:"100%",children:[(0,r.jsx)(N.E,{value:ea,size:"sm",colorScheme:"blue"}),(0,r.jsxs)(E.x,{mt:2,fontSize:"sm",textAlign:"center",children:["Uploading: ",ea.toFixed(0),"%"]})]}),J&&(0,r.jsx)(E.x,{color:"red.500",children:J})]})})}),(0,r.jsxs)(D.k,{width:"50%",direction:"column",p:4,children:[(0,r.jsx)(P.xu,{flex:1,overflowY:"auto",mb:4,maxH:"calc(100vh - 150px)",children:(0,r.jsxs)(C.g,{spacing:4,align:"stretch",overflowY:"auto",flex:1,pb:4,children:[(0,r.jsx)(i.M,{children:e.map((e,t)=>{var s;return(0,r.jsx)(A,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:(0,r.jsx)(D.k,{justify:"user"===e.role?"flex-end":"flex-start",children:(0,r.jsxs)(P.xu,{maxW:"80%",bg:"user"===e.role?"blue.500":ep,color:"user"===e.role?"white":(0,k.ff)("gray.800","white"),borderRadius:"lg",p:3,boxShadow:"sm",children:[(0,r.jsxs)(F.U,{spacing:2,mb:2,children:["user"===e.role?(0,r.jsx)(l.Xws,{}):(0,r.jsx)(l.iNY,{}),(0,r.jsx)(E.x,{fontWeight:"bold",children:"user"===e.role?(null==Q?void 0:null===(s=Q.user)||void 0===s?void 0:s.name)||"You":"GPT-4"})]}),(0,r.jsx)(c.U,{components:{code:_},remarkPlugins:[h.Z,x.Z],rehypePlugins:[g.Z],children:e.content})]})})},t)})}),u&&(0,r.jsx)(D.k,{justify:"flex-start",mb:4,children:(0,r.jsxs)(P.xu,{bg:ep,borderRadius:"lg",p:3,boxShadow:"sm",children:[(0,r.jsx)(T.$,{size:"sm",mr:2}),"GPT-4 is thinking..."]})}),(0,r.jsx)("div",{ref:eb})]})}),(0,r.jsxs)(F.U,{as:"form",onSubmit:e=>{e.preventDefault(),eS()},children:[(0,r.jsx)(M.I,{value:s,onChange:e=>d(e.target.value),placeholder:"Type your message...",disabled:u}),(0,r.jsx)(z.h,{type:"submit",icon:(0,r.jsx)(o.ip9,{}),colorScheme:"blue",isLoading:u,"aria-label":"Send message"})]})]})]})]}),(0,r.jsx)(w.Z,{isOpen:ex,onClose:em})]})}}},function(e){e.O(0,[6771,7699,8310,5505,5452,8422,5129,3954,6314,4868,3252,9796,3413,998,9109,9553,4131,2830,1629,80,9359,7458,4957,8502,1849,6750,4009,7941,2971,7023,1744],function(){return e(e.s=32120)}),_N_E=e.O()}]);